ALTER VIEW `vAssetMaster` AS 
SELECT `a`.`ID` AS `ID`, `a`.`DARAssetID` AS `DARAssetID`, `a`.`DARTicker` AS `DARTicker`, `a`.`Name` AS `Name`
, `a`.`AssetType` AS `AssetType`, `a`.`Description` AS `Description`, `a`.`Sponsor` AS `Sponsor`
, `a`.`IsBenchmarkAsset` AS `IsBenchmarkAsset`, `a`.`SEDOL` AS `SEDOL`, `a`.`ISIN` AS `ISIN`, `a`.`CUSIP` AS `CUSIP`
, `a`.`DTI` AS `DTI`, `a`.`DevelopmentStage` AS `DevelopmentStage`, `a`.`DARSuperSector` AS `DARSuperSector`
, `a`.`DARSuperSectorCode` AS `DARSuperSectorCode`, `a`.`DARSector` AS `DARSector`, `a`.`DARSectorCode` AS `DARSectorCode`
, `a`.`DARSubSector` AS `DARSubSector`, `a`.`DARSubSectorCode` AS `DARSubSectorCode`, `a`.`DarTaxonomyVersion` AS `DarTaxonomyVersion`
, `a`.`DATSSuperSector` AS `DATSSuperSector`, `a`.`DATSSuperSectorCode` AS `DATSSuperSectorCode`, `a`.`DATSSector` AS `DATSSector`
, `a`.`DATSSectorCode` AS `DATSSectorCode`, `a`.`DATSSubSector` AS `DATSSubSector`, `a`.`DATSSubSectorCode` AS `DATSSubSectorCode`
, `a`.`DATSTaxonomyVersion` AS `DATSTaxonomyVersion`, `a`.`IssuanceFramework` AS `IssuanceFramework`, `a`.`IsRestricted` AS `IsRestricted`
, `a`.`EstimatedCirculatingSupply` AS `EstimatedCirculatingSupply`, `a`.`MaxSupply` AS `MaxSupply`, `a`.`MessariTaxonomySector` AS `MessariTaxonomySector`
, `a`.`MessariTaxonomyCategory` AS `MessariTaxonomyCategory`, `a`.`IsActive` AS `IsActive`, `a`.`CreateUser` AS `CreateUser`
, `a`.`LastEditUser` AS `LastEditUser`, `a`.`CreateTime` AS `CreateTime`, `a`.`LastEditTime` AS `LastEditTime`
, `a`.`InstitutionalCustodyAvailable` AS `InstitutionalCustodyAvailable`, `th`.`DarTheme` AS `DarTheme`
, `thDATs`.`DatsTheme` AS `DatsTheme`, `au`.`primaryURL` AS `PrimaryURL`, `au`.`twitter` AS `Twitter`, `au`.`reddit` AS `Reddit`
, `au`.`blog` AS `Blog`, `au`.`whitePaper` AS `WhitePaper`, `au`.`codeRepositoryURL` AS `CodeRepositoryURL`
, `a`.`HasERC20Version` AS `HasERC20Version`, `a`.`HasNYDFSCustoday` AS `HasNYDFSCustoday`, `a`.`LegacyDARAssetId` AS `LegacyDARAssetId`
, `a`.`CirculatingSupply` AS `CirculatingSupply`, `a`.`LegacyId` AS `LegacyId`, `a`.`GovernanceToken` AS `GovernanceToken`
, `a`.`LayerOne` AS `LayerOne` 
, `a`.`CMC_ID` AS `CoinMarketCapId` 
, `a`.`CG_ID` AS `CoinGeckoId`
, `a`.`DATSGovernance` AS `DATSGovernance`
, `a`.`DATSLayer1` AS `DATSLAyer1`
FROM (((`Asset` as `a`  LEFT  JOIN  ( SELECT `d`.`AssetID` AS `AssetID`, MAX( CASE  WHEN (`d`.`Name` = 'Primary URL') THEN `d`.`URLPath` END ) AS `primaryURL`, MAX( CASE  WHEN (`d`.`Name` = 'Twitter') THEN `d`.`URLPath` END ) AS `twitter`, MAX( CASE  WHEN (`d`.`Name` = 'Reddit') THEN `d`.`URLPath` END ) AS `reddit`, MAX( CASE  WHEN (`d`.`Name` = 'Blog') THEN `d`.`URLPath` END ) AS `blog`, MAX( CASE  WHEN (`d`.`Name` = 'White Paper') THEN `d`.`URLPath` END ) AS `whitePaper`, MAX( CASE  WHEN (`d`.`Name` = 'Code Repository URL') THEN `d`.`URLPath` END ) AS `codeRepositoryURL` FROM  ( SELECT `au`.`AssetID` AS `AssetID`, `ut`.`Name` AS `Name`, `au`.`URLPath` AS `URLPath` FROM (`AssetURL` as `au`  JOIN `URLType` as `ut`  ON (`au`.`URLTypeID` = `ut`.`ID`)) ) AS `d` GROUP BY 1 ) AS `au` ON (`a`.`ID` = `au`.`AssetID`)) LEFT  JOIN  ( SELECT `t1`.`AssetId` AS `AssetID`, GROUP_CONCAT(`t1`.`Theme` ORDER BY `t1`.`Theme` SEPARATOR ',') AS `DarTheme` FROM `vAssetTheme` as `t1`  WHERE (`t1`.`ThemeType` = 'DAR') GROUP BY 1 ) AS `th` ON (`th`.`AssetID` = `a`.`ID`)) LEFT  JOIN  ( SELECT `t1`.`AssetId` AS `AssetID`, GROUP_CONCAT(`t1`.`Theme` ORDER BY `t1`.`Theme` SEPARATOR ',') AS `DatsTheme` FROM `vAssetTheme` as `t1`  WHERE (`t1`.`ThemeType` = 'DATS') GROUP BY 1 ) AS `thDATs` ON (`thDATs`.`AssetID` = `a`.`ID`)) /*!90623 OPTION(CLIENT_FOUND_ROWS=1)*/



DELIMITER //
CREATE OR REPLACE PROCEDURE `spDMLAsset`(_Operation varchar(20) CHARACTER SET utf8 COLLATE utf8_general_ci NULL, _DARAssetID varchar(20) CHARACTER SET utf8 COLLATE utf8_general_ci NULL, _DARTicker varchar(20) CHARACTER SET utf8 COLLATE utf8_general_ci NULL, _Name varchar(100) CHARACTER SET utf8 COLLATE utf8_general_ci NULL, _CreateUser varchar(100) CHARACTER SET utf8 COLLATE utf8_general_ci NULL, _LastEditUser varchar(100) CHARACTER SET utf8 COLLATE utf8_general_ci NULL, _ID bigint(16) NULL DEFAULT 0, _AssetType varchar(200) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL, _Description varchar(1500) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL, _Sponsor varchar(255) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL, _IsBenchmarkAsset tinyint(4) NULL DEFAULT NULL, _SEDOL varchar(200) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL, _ISIN varchar(200) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL, _CUSIP varchar(200) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL, _DTI varchar(200) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL, _DevelopmentStage varchar(200) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL, _MessariTaxonomySector varchar(500) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL, _MessariTaxonomyCategory varchar(500) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL, _DARSuperSector varchar(200) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL, _DARSuperSectorCode varchar(200) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL, _DARSector varchar(200) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL, _DARSectorCode varchar(200) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL, _DARSubSector varchar(200) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL, _DARSubSectorCode varchar(200) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL, _DarTaxonomyVersion decimal(11,10) NULL DEFAULT NULL, _IssuanceFramework varchar(200) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL, _IsRestricted tinyint(4) NULL DEFAULT NULL, _EstimatedCirculatingSupply decimal(16,15) NULL DEFAULT NULL, _MaxSupply decimal(18,0) NULL DEFAULT NULL, _LegacyId int(11) NULL DEFAULT NULL, _LegacyDARAssetId varchar(20) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL, _InstitutionalCustodyAvailable tinyint(4) NULL DEFAULT NULL, _DATSSuperSector varchar(200) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL, _DATSSuperSectorCode varchar(200) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL, _DATSSector varchar(200) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL, _DATSSectorCode varchar(200) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL, _DATSSubSector varchar(200) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL, _DATSSubSectorCode varchar(200) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL, _DATSTaxonomyVersion decimal(11,10) NULL DEFAULT NULL, _HasERC20Version tinyint(4) NULL DEFAULT NULL, _HasNYDFSCustoday tinyint(4) NULL DEFAULT NULL, _CMC_ID varchar(255) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL, _CG_ID varchar(255) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL, _CirculatingSupply decimal(18,0) NULL DEFAULT NULL, _IsActive tinyint(4) NULL DEFAULT 1, _GovernanceToken varchar(20) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT null, _LayerOne varchar(20) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT null, _DATSGovernance varchar(20) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT null, _DATSLayer1 varchar(20) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT null) RETURNS text CHARACTER SET utf8 COLLATE utf8_general_ci NULL AS
DECLARE 
	idcount_query QUERY(a INT) = SELECT COUNT(*)
		FROM Asset
		WHERE DARAssetID=_DARAssetID OR DARTicker=_DARTicker OR Name=_Name;
	id_count INT = 0; 
	v_date DATETIME;
	output TEXT = CONCAT(current_timestamp(), ", method: ", (_Operation), ", message: "); 
	v_id BIGINT(16); 
        
BEGIN
	SELECT NOW() INTO v_date;
    id_count = SCALAR(idcount_query);
	IF id_count = 0 THEN
		START TRANSACTION;
		INSERT INTO Asset(DARAssetID , DARTicker, Name , AssetType , IsActive ,CreateUser , LastEditUser , CreateTime , LastEditTime  , Description , Sponsor, IsBenchmarkAsset, GovernanceToken, LayerOne, SEDOL, ISIN , CUSIP , DTI  , DevelopmentStage , MessariTaxonomySector , MessariTaxonomyCategory , DARSuperSector , DARSuperSectorCode  ,DARSector ,DARSectorCode , DARSubSector , DARSubSectorCode , DarTaxonomyVersion , IssuanceFramework , IsRestricted , EstimatedCirculatingSupply , MaxSupply , LegacyId , LegacyDARAssetId , InstitutionalCustodyAvailable , DATSSuperSector , DATSSuperSectorCode , DATSSector ,DATSSectorCode ,DATSSubSector , DATSSubSectorCode , DATSTaxonomyVersion ,HasERC20Version , HasNYDFSCustoday , CMC_ID , CG_ID, CirculatingSupply, DATSGovernance, DATSLayer1 ) 
		Values (_DARAssetID , _DARTicker, _Name , _AssetType , _IsActive ,_CreateUser , _LastEditUser, v_date , v_date  , _Description , _Sponsor, _IsBenchmarkAsset, _GovernanceToken, _LayerOne, _SEDOL, _ISIN , _CUSIP , _DTI  , _DevelopmentStage , _MessariTaxonomySector , _MessariTaxonomyCategory , _DARSuperSector , _DARSuperSectorCode  ,_DARSector , _DARSectorCode , _DARSubSector , _DARSubSectorCode , _DarTaxonomyVersion , _IssuanceFramework , _IsRestricted , _EstimatedCirculatingSupply , _MaxSupply , _LegacyId , _LegacyDARAssetId , _InstitutionalCustodyAvailable , _DATSSuperSector , _DATSSuperSectorCode , _DATSSector ,_DATSSectorCode ,_DATSSubSector , _DATSSubSectorCode , _DATSTaxonomyVersion ,_HasERC20Version , _HasNYDFSCustoday , _CMC_ID , _CG_ID, _CirculatingSupply, _DATSGovernance, _DATSLayer1);
        
        SELECT ID FROM Asset WHERE DARAssetID=_DARAssetID OR DARTicker=_DARTicker OR Name=_Name into v_id;
        CALL spDMLAssetAudit("INSERT", _DARAssetID , _LastEditUser, _DARTicker, _Name , _CreateUser , v_id, _AssetType , _Description , _Sponsor, _IsBenchmarkAsset, _SEDOL, _ISIN , _CUSIP , _DTI  , _DevelopmentStage , _MessariTaxonomySector , _MessariTaxonomyCategory , _DARSuperSector , _DARSuperSectorCode  ,_DARSector , _DARSectorCode , _DARSubSector , _DARSubSectorCode , _DarTaxonomyVersion , _IssuanceFramework , _IsRestricted , _EstimatedCirculatingSupply , _MaxSupply , _LegacyId , _LegacyDARAssetId , _InstitutionalCustodyAvailable , _DATSSuperSector , _DATSSuperSectorCode , _DATSSector ,_DATSSectorCode ,_DATSSubSector , _DATSSubSectorCode , _DATSTaxonomyVersion ,_HasERC20Version , _HasNYDFSCustoday , _CMC_ID , _CG_ID, _CirculatingSupply, _IsActive,_GovernanceToken, _LayerOne, _DATSGovernance, _DATSLayer1 );
		SELECT ID FROM Asset WHERE DARAssetID=_DARAssetID AND DARTicker=_DARTicker AND Name=_Name INTO v_id;
		output = CONCAT(output, "SUCCESS"); 
		ECHO SELECT v_id as ID, output AS RowOutput; 		
	ELSE
		output = CONCAT(output, "FAIL"); 
        ECHO SELECT v_id as ID, output AS RowOutput; 	
	END IF;
	RETURN v_id;
    
END; //


DELIMITER //
CREATE OR REPLACE PROCEDURE `spDMLAssetAudit`(_Operation varchar(20) CHARACTER SET utf8 COLLATE utf8_general_ci NULL, _DARAssetID varchar(20) CHARACTER SET utf8 COLLATE utf8_general_ci NULL, _LastEditUser varchar(100) CHARACTER SET utf8 COLLATE utf8_general_ci NULL, _DARTicker varchar(20) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL, _Name varchar(100) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL, _CreateUser varchar(100) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL, _ID bigint(16) NULL DEFAULT 0, _AssetType varchar(200) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL, _Description varchar(1500) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL, _Sponsor varchar(255) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL, _IsBenchmarkAsset tinyint(4) NULL DEFAULT NULL, _SEDOL varchar(200) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL, _ISIN varchar(200) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL, _CUSIP varchar(200) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL, _DTI varchar(200) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL, _DevelopmentStage varchar(200) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL, _MessariTaxonomySector varchar(500) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL, _MessariTaxonomyCategory varchar(500) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL, _DARSuperSector varchar(200) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL, _DARSuperSectorCode varchar(200) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL, _DARSector varchar(200) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL, _DARSectorCode varchar(200) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL, _DARSubSector varchar(200) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL, _DARSubSectorCode varchar(200) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL, _DarTaxonomyVersion decimal(11,10) NULL DEFAULT NULL, _IssuanceFramework varchar(200) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL, _IsRestricted tinyint(4) NULL DEFAULT NULL, _EstimatedCirculatingSupply decimal(16,15) NULL DEFAULT NULL, _MaxSupply decimal(18,0) NULL DEFAULT NULL, _LegacyId int(11) NULL DEFAULT NULL, _LegacyDARAssetId varchar(20) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL, _InstitutionalCustodyAvailable tinyint(4) NULL DEFAULT NULL, _DATSSuperSector varchar(200) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL, _DATSSuperSectorCode varchar(200) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL, _DATSSector varchar(200) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL, _DATSSectorCode varchar(200) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL, _DATSSubSector varchar(200) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL, _DATSSubSectorCode varchar(200) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL, _DATSTaxonomyVersion decimal(11,10) NULL DEFAULT NULL, _HasERC20Version tinyint(4) NULL DEFAULT NULL, _HasNYDFSCustoday tinyint(4) NULL DEFAULT NULL, _CMC_ID varchar(255) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL, _CG_ID varchar(255) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL, _CirculatingSupply decimal(18,0) NULL DEFAULT NULL, _IsActive tinyint(4) NULL DEFAULT 1, _GovernanceToken varchar(20) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT null, _LayerOne varchar(20) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT null) RETURNS void AS
DECLARE
	v_date DATETIME;
	BEGIN
		SELECT NOW() INTO v_date;
		IF (_Operation ='INSERT') THEN
			INSERT INTO Asset_Audit(ID, DARAssetID, DARTicker, Name, AssetType, IsActive, CreateUser, LastEditUser, CreateTime, LastEditTime, Description, Sponsor, IsBenchmarkAsset, SEDOL, ISIN, CUSIP, DTI, DevelopmentStage, MessariTaxonomySector, MessariTaxonomyCategory, DARSuperSector, DARSuperSectorCode, DARSector, DARSectorCode, DARSubSector, DARSubSectorCode, DarTaxonomyVersion, IssuanceFramework, IsRestricted, EstimatedCirculatingSupply, MaxSupply, operation, LegacyId, LegacyDARAssetId, InstitutionalCustodyAvailable, DATSSuperSector, DATSSuperSectorCode, DATSSector, DATSSectorCode, DATSSubSector, DATSSubSectorCode, DATSTaxonomyVersion, HasERC20Version, HasNYDFSCustoday, CMC_ID, CG_ID, CirculatingSupply, DATSGovernance, DATSLayer1)
			VALUES (_ID, _DARAssetID , _DARTicker, _Name , _AssetType , _IsActive ,_CreateUser , _LastEditUser , v_date , v_date  , _Description , _Sponsor, _IsBenchmarkAsset, _SEDOL, _ISIN , _CUSIP , _DTI  , _DevelopmentStage , _MessariTaxonomySector , _MessariTaxonomyCategory , _DARSuperSector , _DARSuperSectorCode  ,_DARSector , _DARSectorCode , _DARSubSector , _DARSubSectorCode , _DarTaxonomyVersion , _IssuanceFramework , _IsRestricted , _EstimatedCirculatingSupply , _MaxSupply , _Operation , _LegacyId , _LegacyDARAssetId , _InstitutionalCustodyAvailable , _DATSSuperSector , _DATSSuperSectorCode , _DATSSector ,_DATSSectorCode ,_DATSSubSector , _DATSSubSectorCode , _DATSTaxonomyVersion ,_HasERC20Version , _HasNYDFSCustoday , _CMC_ID , _CG_ID, _CirculatingSupply, _DATSGovernance, _DATSLayer1);
			COMMIT;
		ELSEIF (_Operation ='UPDATE') THEN
			INSERT INTO Asset_Audit( operation, LastEditUser, LastEditTime, ID, DARAssetID, DARTicker, Name, AssetType, IsActive, CreateUser, CreateTime, Description, Sponsor, IsBenchmarkAsset, SEDOL, ISIN, CUSIP, DTI, DevelopmentStage, MessariTaxonomySector, MessariTaxonomyCategory, DARSuperSector, DARSuperSectorCode, DARSector, DARSectorCode, DARSubSector, DARSubSectorCode, DarTaxonomyVersion, IssuanceFramework, IsRestricted, EstimatedCirculatingSupply, MaxSupply, LegacyId, LegacyDARAssetId, InstitutionalCustodyAvailable, DATSSuperSector, DATSSuperSectorCode, DATSSector, DATSSectorCode, DATSSubSector, DATSSubSectorCode, DATSTaxonomyVersion, HasERC20Version, HasNYDFSCustoday, CMC_ID, CG_ID, CirculatingSupply, DATSGovernance, DATSLayer1)
			SELECT "UPDATE",_LastEditUser,v_date, ID, DARAssetID, DARTicker, Name, AssetType, IsActive, CreateUser, CreateTime, Description, Sponsor, IsBenchmarkAsset, SEDOL, ISIN, CUSIP, DTI, DevelopmentStage, MessariTaxonomySector, MessariTaxonomyCategory, DARSuperSector, DARSuperSectorCode, DARSector, DARSectorCode, DARSubSector, DARSubSectorCode, DarTaxonomyVersion, IssuanceFramework, IsRestricted, EstimatedCirculatingSupply, MaxSupply, LegacyId, LegacyDARAssetId, InstitutionalCustodyAvailable, DATSSuperSector, DATSSuperSectorCode, DATSSector, DATSSectorCode, DATSSubSector, DATSSubSectorCode, DATSTaxonomyVersion, HasERC20Version, HasNYDFSCustoday, CMC_ID, CG_ID, CirculatingSupply, DATSGovernance, DATSLayer1 FROM refmaster_internal.Asset_Audit WHERE DARAssetID=_DARAssetID and operation = "INSERT" order by LastEditTime desc LIMIT 1;
			COMMIT;
		ELSEIF (_Operation ='DELETE') THEN
			INSERT INTO Asset_Audit( operation, LastEditUser, LastEditTime, ID, DARAssetID, DARTicker, Name, AssetType, IsActive, CreateUser, CreateTime, Description, Sponsor, IsBenchmarkAsset, SEDOL, ISIN, CUSIP, DTI, DevelopmentStage, MessariTaxonomySector, MessariTaxonomyCategory, DARSuperSector, DARSuperSectorCode, DARSector, DARSectorCode, DARSubSector, DARSubSectorCode, DarTaxonomyVersion, IssuanceFramework, IsRestricted, EstimatedCirculatingSupply, MaxSupply, LegacyId, LegacyDARAssetId, InstitutionalCustodyAvailable, DATSSuperSector, DATSSuperSectorCode, DATSSector, DATSSectorCode, DATSSubSector, DATSSubSectorCode, DATSTaxonomyVersion, HasERC20Version, HasNYDFSCustoday, CMC_ID, CG_ID, CirculatingSupply, DATSGovernance, DATSLayer1)
			SELECT "DELETE",_LastEditUser,v_date, ID, DARAssetID, DARTicker, Name, AssetType, IsActive, CreateUser, CreateTime, Description, Sponsor, IsBenchmarkAsset, SEDOL, ISIN, CUSIP, DTI, DevelopmentStage, MessariTaxonomySector, MessariTaxonomyCategory, DARSuperSector, DARSuperSectorCode, DARSector, DARSectorCode, DARSubSector, DARSubSectorCode, DarTaxonomyVersion, IssuanceFramework, IsRestricted, EstimatedCirculatingSupply, MaxSupply, LegacyId, LegacyDARAssetId, InstitutionalCustodyAvailable, DATSSuperSector, DATSSuperSectorCode, DATSSector, DATSSectorCode, DATSSubSector, DATSSubSectorCode, DATSTaxonomyVersion, HasERC20Version, HasNYDFSCustoday, CMC_ID, CG_ID, CirculatingSupply, DATSGovernance, DATSLayer1 FROM refmaster_internal.Asset_Audit WHERE DARAssetID=_DARAssetID and operation = "INSERT" order by LastEditTime desc LIMIT 1;
			COMMIT;
		END IF;
	
END; //